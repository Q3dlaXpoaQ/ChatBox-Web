/*! For license information please see 8477.929008c2bfbb4bf0dfe3.js.LICENSE.txt */
"use strict";(self.webpackChunkxyz_chatboxapp_ce=self.webpackChunkxyz_chatboxapp_ce||[]).push([[8477],{78477:(e,t,s)=>{s.r(t),s.d(t,{component:()=>We});var o=s(74848),r=s(91040),n=s(99460),i=s(40054),a=s(48324),l=s(89652),c=s(12335),d=s(14566),h=s(58418),u=s(87370),x=s(34164),p=s(96540),m=s(34195),g=s(41258),b=s(42446),k=s(24648),v=s(8097),y=s(60506),j=s(74791),C=s(5055),f=s(69437),w=s(38728),M=(0,w.A)("outline","history","IconHistory",[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]]),A=(0,w.A)("outline","device-floppy","IconDeviceFloppy",[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]]),T=s(4225),S=s(43325),I=(0,w.A)("outline","clear-all","IconClearAll",[["path",{d:"M8 6h12",key:"svg-0"}],["path",{d:"M6 12h12",key:"svg-1"}],["path",{d:"M4 18h12",key:"svg-2"}]]),N=s(34843),L=s(36920),z=s(58641),B=s(88194),R=s(27812),E=s(93478);function W(e){const{size:t,stroke:s,title:r,...n}=e;return(0,o.jsxs)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":r,...n,children:[(0,o.jsx)("path",{d:"M7.70645 13.5434C8.64996 10.9436 10.9734 9 13.7391 9V9C16.2165 9 18.3751 10.7902 18.4797 13.2653C18.5126 14.0442 18.5096 14.8236 18.4403 15.5C18.1575 18.2585 17.4848 19.828 17.0944 20.5366C16.9293 20.8364 16.5944 20.9749 16.2545 20.9335L6.09365 19.6943C5.35876 19.6047 4.96691 18.7727 5.3513 18.14C6.00064 17.0711 6.86657 15.5722 7.37006 14.4C7.48471 14.1331 7.59731 13.8441 7.70645 13.5434Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M18 13.5L9 12.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M8.5 20C8.5 20 10.2 17.7222 11 15.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M12.5 20.5C12.5 20.5 14 18.5 14.5 16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M14.5 8.5L16 3.5",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})]})}function $(e){const{size:t,stroke:s=2,title:r,...n}=e;return(0,o.jsxs)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":r,...n,children:[(0,o.jsx)("rect",{x:"7.5",y:"5",width:"9",height:"14",fill:"currentColor",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]})}function F(e){const{size:t,stroke:s=2,title:r,...n}=e;return(0,o.jsxs)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":r,...n,children:[(0,o.jsx)("rect",{x:"9.5",y:"5",width:"5",height:"14",fill:"currentColor",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:s,strokeLinecap:"round",strokeLinejoin:"round"})]})}var H=s(44986);const P=()=>{const{t:e}=(0,m.Bd)();return(0,o.jsx)(C.$,{h:28,px:"xs",bd:0,radius:14,variant:"light",color:"chatbox-warning",leftSection:(0,o.jsx)(j.n,{icon:H.A}),onClick:()=>{L.A.installUpdate()},children:e("Update Available")})};function U({sessionId:e}){const{t}=(0,m.Bd)(),s=(0,v.L0)(),r=(0,v.dZ)(),[l,c]=(0,p.useState)(!1),d=(0,b.j)((e=>e.setOpenSearchDialog)),h=(0,N.Xr)(R.Kq),u=(0,b.j)((e=>e.widthFull)),x=(0,b.j)((e=>e.setWidthFull));(0,p.useEffect)((()=>{const e=L.A.onUpdateDownloaded((()=>{c(!0)}));return()=>{e()}}),[]);const k=()=>{n.Ay.show("export-chat")},y=()=>{(0,g.IU)(e)},w=async()=>{try{await(0,B.ME)(e),z.Q.navigate({to:"/",replace:!0})}catch(e){console.error("Failed to delete session:",e)}};(0,p.useCallback)((async()=>{const s=await(0,B.Ht)(e);s&&await n.Ay.show("json-viewer",{title:t("Session Raw JSON"),data:s})}),[e,t]);return s?(0,o.jsxs)(i.s,{align:"center",gap:"xs",children:[(0,o.jsx)(a.M,{variant:"subtle",size:24,color:"chatbox-secondary",onClick:()=>d(!0),children:(0,o.jsx)(f.A,{strokeWidth:1.8})}),(0,o.jsx)(E.A,{position:"bottom-end",items:[{text:t("Thread History"),icon:M,onClick:()=>h(!0)},{text:t("Export Chat"),icon:A,onClick:k},{divider:!0},{doubleCheck:{color:"chatbox-error"},text:t("Clear All Messages"),icon:I,color:"chatbox-primary",onClick:y},{doubleCheck:{color:"chatbox-error"},text:t("Delete Current Session"),icon:T.A,color:"chatbox-primary",onClick:w}],children:(0,o.jsx)(a.M,{variant:"subtle",size:24,color:"chatbox-secondary",children:(0,o.jsx)(S.A,{strokeWidth:1.8})})})]}):(0,o.jsxs)(i.s,{align:"center",gap:"md",className:"controls",children:[l&&(0,o.jsx)(P,{}),s?(0,o.jsx)(a.M,{variant:"subtle",size:28,color:"chatbox-secondary",onClick:()=>d(!0),children:(0,o.jsx)(f.A,{strokeWidth:1.8})}):(0,o.jsxs)(C.$,{h:28,px:"xs",radius:"sm",variant:"outline",color:"chatbox-tertiary",leftSection:(0,o.jsx)(j.n,{icon:f.A,size:16,strokeWidth:1.8}),className:"border-chatbox-border-primary",onClick:()=>d(!0),children:[t("Search"),"..."]}),r&&(0,o.jsx)(a.M,{variant:"subtle",size:28,color:"chatbox-secondary",onClick:()=>x(!u),children:u?(0,o.jsx)($,{strokeWidth:1.8}):(0,o.jsx)(F,{strokeWidth:1.8})}),(0,o.jsx)(a.M,{variant:"subtle",size:28,color:"chatbox-secondary",onClick:()=>h(!0),children:(0,o.jsx)(M,{strokeWidth:1.8})}),(0,o.jsx)(E.A,{position:"bottom-end",items:[{text:t("Export Chat"),icon:A,onClick:k},{divider:!0},{doubleCheck:{color:"chatbox-error"},text:t("Clear All Messages"),icon:W,color:"chatbox-primary",onClick:y},{doubleCheck:{color:"chatbox-error"},text:t("Delete Current Session"),icon:T.A,color:"chatbox-primary",onClick:w}],children:(0,o.jsx)(a.M,{variant:"subtle",size:28,color:"chatbox-secondary",children:(0,o.jsx)(S.A,{strokeWidth:1.8})})})]})}var D=s(9607);function q(e){const{t}=(0,m.Bd)(),s=(0,b.j)((e=>e.showSidebar)),r=(0,b.j)((e=>e.setShowSidebar)),C=(0,v.L0)(),{needRoomForMacWindowControls:f}=(0,k.Ay)(),{session:w}=e;(0,p.useEffect)((()=>{if(!y.tr())return;w.messages.some((e=>e.generating))||w.messages.length<2||("Untitled"===w.name?(0,g.mL)(w.id):w.threadName||(0,g.qC)(w.id))}),[w]);return(0,o.jsxs)(i.s,{h:54,align:"center",px:"sm",className:(0,x.A)("flex-none title-bar border-0 border-b border-solid border-chatbox-border-primary"),children:[(!s||C)&&(0,o.jsx)(i.s,{align:"center",className:f?"pl-20":"",children:(0,o.jsx)(a.M,{className:"controls",variant:"subtle",size:C?24:20,color:C?"chatbox-secondary":"chatbox-tertiary",mr:"sm",onClick:()=>r(!s),children:C?(0,o.jsx)(d.A,{}):(0,o.jsx)(h.A,{})})}),(0,o.jsxs)(i.s,{align:"center",gap:"xxs",flex:1,...C?{justify:"center",pl:28,pr:8}:{},children:[(0,o.jsx)(l.h,{order:4,fz:C?void 0:20,lineClamp:1,children:w?.name}),(0,o.jsx)(c.m,{label:t("Customize settings for the current conversation"),children:(0,o.jsx)(a.M,{className:"controls",variant:"subtle",color:"chatbox-tertiary",size:20,onClick:()=>{w&&n.Ay.show("session-settings",{session:w})},children:(0,o.jsx)(j.n,{icon:u.A,size:20})})})]}),(0,o.jsx)(U,{sessionId:w.id}),(0,o.jsx)(D.A,{className:"-mr-3 ml-2"})]})}var O=s(96389),_=s(69019),K=s(73087),V=s(17826),G=s(12569);function Z(e,t){return function(e,t){const s=(0,G.c)(e),o=(0,p.useRef)(null),r=(0,p.useRef)(null),n=(0,p.useRef)(!0),i=(0,p.useRef)(t),a=(0,p.useRef)(-1),l=(0,p.useCallback)(((...e)=>{s(...e),o.current=e,r.current=e,n.current=!1}),[s]),c=(0,p.useCallback)((()=>{o.current&&o.current!==r.current?(l(...o.current),a.current=window.setTimeout(c,i.current)):n.current=!0}),[l]),d=(0,p.useCallback)(((...e)=>{n.current?(l(...e),a.current=window.setTimeout(c,i.current)):o.current=e}),[l,c]);return(0,p.useEffect)((()=>{i.current=t}),[t]),[d,()=>window.clearTimeout(a.current)]}(e,t)[0]}var X=(0,w.A)("outline","arrow-bar-to-up","IconArrowBarToUp",[["path",{d:"M12 10l0 10",key:"svg-0"}],["path",{d:"M12 10l4 4",key:"svg-1"}],["path",{d:"M12 10l-4 4",key:"svg-2"}],["path",{d:"M4 4l16 0",key:"svg-3"}]]),J=s(35583),Q=s(30357),Y=(0,w.A)("outline","align-right","IconAlignRight",[["path",{d:"M4 6l16 0",key:"svg-0"}],["path",{d:"M10 12l10 0",key:"svg-1"}],["path",{d:"M6 18l14 0",key:"svg-2"}]]),ee=s(74192),te=(0,w.A)("outline","list-tree","IconListTree",[["path",{d:"M9 6h11",key:"svg-0"}],["path",{d:"M12 12h8",key:"svg-1"}],["path",{d:"M15 18h5",key:"svg-2"}],["path",{d:"M5 6v.01",key:"svg-3"}],["path",{d:"M8 12v.01",key:"svg-4"}],["path",{d:"M11 18v.01",key:"svg-5"}]]),se=(0,w.A)("outline","switch-3","IconSwitch3",[["path",{d:"M3 17h2.397a5 5 0 0 0 4.096 -2.133l.177 -.253m3.66 -5.227l.177 -.254a5 5 0 0 1 4.096 -2.133h3.397",key:"svg-0"}],["path",{d:"M18 4l3 3l-3 3",key:"svg-1"}],["path",{d:"M3 7h2.397a5 5 0 0 1 4.096 2.133l4.014 5.734a5 5 0 0 0 4.096 2.133h3.397",key:"svg-2"}],["path",{d:"M18 20l3 -3l-3 -3",key:"svg-3"}]]),oe=(0,w.A)("outline","message-plus","IconMessagePlus",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M12.01 18.594l-4.01 2.406v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v5.5",key:"svg-2"}],["path",{d:"M16 19h6",key:"svg-3"}],["path",{d:"M19 16v6",key:"svg-4"}]]),re=s(71163),ne=s(63635),ie=s(90674),ae=s(25203),le=s(33491),ce=s(74366),de=s(63403),he=s(11507),ue=(0,w.A)("outline","chevrons-up","IconChevronsUp",[["path",{d:"M7 11l5 -5l5 5",key:"svg-0"}],["path",{d:"M7 17l5 -5l5 5",key:"svg-1"}]]),xe=s(95561),pe=s(11922),me=(0,w.A)("outline","chevrons-down","IconChevronsDown",[["path",{d:"M7 7l5 5l5 -5",key:"svg-0"}],["path",{d:"M7 13l5 5l5 -5",key:"svg-1"}]]),ge=s(77956);const be=(0,p.memo)((({visible:e,onVisibleChange:t,onScrollToTop:s,onScrollToBottom:r,onScrollToPrev:n,onScrollToNext:i})=>{const a=(0,p.useRef)(null),l=(0,p.useCallback)((()=>{a.current&&clearTimeout(a.current),t?.(!0)}),[t]),c=(0,p.useCallback)((()=>{a.current&&clearTimeout(a.current),a.current=setTimeout((()=>{a.current=null,t?.(!1)}),2e3)}),[t]);return(0,o.jsx)("div",{className:(0,x.$)("absolute right-0 py-6 pl-2 bottom-0 transition-all",e?"-translate-x-3 opacity-100":"translate-x-1/2 opacity-0"),onMouseEnter:l,onMouseLeave:c,children:(0,o.jsxs)(_.B,{gap:6,p:"xxs",className:"rounded border border-solid border-chatbox-border-primary bg-chatbox-background-primary [&>.mantine-Divider-root]:border-chatbox-border-primary",children:[(0,o.jsx)(ke,{icon:(0,o.jsx)(ue,{}),onClick:s}),(0,o.jsx)(de.c,{}),(0,o.jsx)(ke,{icon:(0,o.jsx)(xe.A,{}),onClick:n}),(0,o.jsx)(de.c,{}),(0,o.jsx)(ke,{icon:(0,o.jsx)(pe.A,{}),onClick:i}),(0,o.jsx)(de.c,{}),(0,o.jsx)(ke,{icon:(0,o.jsx)(me,{}),onClick:r})]})})})),ke=({icon:e,...t})=>(0,o.jsx)("button",{className:(0,x.$)("flex border-0 outline-none [-webkit-tap-highlight-color:transparent] p-0 cursor-pointer text-chatbox-tint-tertiary active:translate-y-px","bg-transparent hover:text-chatbox-tint-secondary"),...t,children:(0,o.jsx)(he.a,{component:"span",w:16,h:16,className:"[&>svg]:w-full [&>svg]:h-full",children:e})}),ve=({onClick:e,style:t})=>(0,o.jsx)(he.a,{className:"absolute bottom-5 right-2",children:(0,o.jsx)(C.$,{w:38,h:38,radius:19,p:0,bg:"var(--chatbox-background-primary)",c:"chatbox-primary",className:"shadow-xl border-chatbox-border-primary",onClick:e,style:t,children:(0,o.jsx)(ge.A,{size:20})})}),ye=new Map,je=(0,p.forwardRef)(((e,t)=>{const{t:s}=(0,m.Bd)(),n=(0,v.L0)(),a=(0,b.j)((e=>e.widthFull)),{currentSession:l}=e,c=(0,p.useMemo)((()=>l&&(0,ie.a4)(l)),[l]),d=(0,p.useMemo)((()=>(0,ie.f$)(l)),[l]),h=(0,p.useRef)(null),u=(0,p.useRef)(null),x=(0,b.j)((e=>e.setMessageListElement)),g=(0,b.j)((e=>e.setMessageScrolling)),[y,f]=(0,p.useState)(!1),w=(0,p.useCallback)((e=>f(e)),[]),M=(0,p.useCallback)((()=>{h.current?.scrollToIndex({index:0,align:"start",behavior:"smooth"})}),[]),A=(0,p.useCallback)((()=>{h.current?.scrollTo({top:1/0,behavior:"smooth"})}),[]),T=(0,p.useCallback)((()=>{if(u?.current&&h?.current){const e=u.current.getBoundingClientRect();for(let t=0;t<d.length;t++){const s=d[t];if("user"!==s.role&&"assistant"!==s.role)continue;const o=u.current.querySelector(`[data-testid="virtuoso-item-list"] > [data-index="${t}"]`);if(o){if(o.getBoundingClientRect().bottom>e.top){for(let e=t-1;e>=0;e--)if("user"===d[e].role)return void h.current.scrollToIndex({index:e,align:"start",offset:n?-28:0,behavior:"smooth"});return void h.current.scrollToIndex({index:0,align:"start",behavior:"smooth"})}}}}}),[d,n]),S=(0,p.useCallback)((()=>{if(u?.current&&h?.current){const e=u.current.getBoundingClientRect();for(let t=0;t<d.length;t++){const s=d[t];if("user"!==s.role&&"assistant"!==s.role)continue;const o=u.current.querySelector(`[data-testid="virtuoso-item-list"] > [data-index="${t}"]`);if(o){if(o.getBoundingClientRect().bottom>e.top){for(let e=t+1;e<d.length;e++)if("user"===d[e].role)return void h.current.scrollToIndex({index:e,align:"start",behavior:"smooth"});return void h.current.scrollToIndex({index:d.length-1,align:"end",behavior:"smooth"})}}}}}),[d]),[I,L]=(0,p.useState)(!1),[z,B]=(0,p.useState)(!1),[R,E]=(0,p.useState)(!1),W=(0,p.useRef)(),$=(0,p.useRef)(null);(0,p.useEffect)((()=>()=>{$.current&&clearTimeout($.current)}),[]);const F=Z((e=>{"number"==typeof e&&"number"==typeof W.current&&(e>0&&e<W.current?(E(!0),$.current&&(clearTimeout($.current),$.current=null),$.current=setTimeout((()=>E(!1)),3e3)):(E(!1),$.current&&(clearTimeout($.current),$.current=null))),W.current=e}),256),H=(0,p.useCallback)((e=>{const t=e.currentTarget.scrollTop;e.currentTarget.scrollHeight-(t+e.currentTarget.clientHeight)>=0&&F(t)}),[F]);(0,p.useEffect)((()=>{g(h);const e=h.current;return()=>{e?.getState((e=>{e.ranges.length>0&&ye.set(l.id,e)}))}}),[]),(0,p.useEffect)((()=>{x(u)}),[]);const P=(0,N.md)(k.rs);return(0,p.useImperativeHandle)(t,(()=>({scrollToTop:(e="auto")=>h.current?.scrollTo({top:0,behavior:e}),scrollToBottom:(e="auto")=>h.current?.scrollTo({top:1/0,behavior:e})}))),(0,o.jsx)("div",{className:(0,ne.cn)("w-full h-full mx-auto",e.className),children:(0,o.jsx)(le.mm,{defaultCollapsed:!!ae.dK.getState().autoCollapseCodeBlock,children:(0,o.jsxs)("div",{className:"overflow-hidden h-full pr-0 pl-1 sm:pl-0 relative",ref:u,children:[(0,o.jsx)(re.aY,{style:{scrollbarGutter:"stable"},className:"win32"===P?"scrollbar-custom":"",data:d,ref:h,followOutput:"smooth",...ye.has(l.id)?{restoreStateFrom:ye.get(l.id),initialScrollTop:ye.get(l.id)?.scrollTop}:{initialTopMostItemIndex:d.length-1},increaseViewportBy:{top:2e3,bottom:2e3},itemContent:(e,t)=>(0,o.jsxs)(_.B,{gap:0,className:a?"w-full":"max-w-4xl mx-auto",pt:"user"===t.role?4:0,children:[c[t.id]&&(0,o.jsx)(we,{thread:c[t.id],sessionId:l.id}),(0,o.jsx)(r.t,{name:"message-item",children:(0,o.jsx)(ce.A,{id:t.id,msg:t,sessionId:l.id,sessionType:l.type||"chat",className:0===e?"pt-4":e===d.length-1?"!pb-4":"",collapseThreshold:"system"===t.role?150:void 0,buttonGroup:e===d.length-1&&"assistant"===t.role?"always":"auto",assistantAvatarKey:l.assistantAvatarKey,sessionPicUrl:l.picUrl})}),l.messageForksHash?.[t.id]&&l.messageForksHash[t.id].lists.length>1&&(0,o.jsx)(i.s,{justify:"flex-end",mt:-16,pr:"md",mr:"md",className:"z-10 self-end",children:(0,o.jsx)(fe,{sessionId:l.id,msgId:t.id,forks:l.messageForksHash[t.id]})})]},t.id),atTopStateChange:B,atBottomStateChange:L,onScroll:H}),n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(K.e,{mounted:R&&!z,transition:"fade-down",children:e=>(0,o.jsx)(i.s,{style:e,className:"absolute z-10 top-0 left-0 right-0 leading-tight bg-chatbox-background-secondary",children:[{text:s("Return to the top"),icon:X,onClick:M},{text:s("Back to previous message"),icon:J.A,onClick:T}].map(((e,t)=>(0,o.jsx)(C.$,{variant:"transparent",className:(0,ne.cn)("w-1/2",0===t?"border-r border-r-chatbox-border-primary":""),classNames:{section:"!mr-xxs"},size:"xs",h:"auto",py:6,c:"chatbox-tertiary",onClick:e.onClick,leftSection:(0,o.jsx)(j.n,{icon:e.icon,size:16}),children:e.text},e.text)))})}),(0,o.jsx)(K.e,{mounted:!I,transition:"slide-up",children:e=>(0,o.jsx)(ve,{onClick:A,style:e})})]}):(0,o.jsx)(be,{visible:y,onVisibleChange:w,onScrollToTop:M,onScrollToBottom:A,onScrollToPrev:T,onScrollToNext:S})]})})})})),Ce=(0,p.memo)(je);function fe(e){const{sessionId:t,msgId:s,forks:r}=e,[n,l]=(0,p.useState)(!1),c=(0,p.useRef)(r.lists.length),{t:d}=(0,m.Bd)();return(0,p.useEffect)((()=>{if(r.lists.length>c.current){l(!0);const e=setTimeout((()=>l(!1)),2e3);return()=>clearTimeout(e)}c.current=r.lists.length}),[r.lists.length]),(0,o.jsxs)(i.s,{gap:"xs",align:"center",children:[(0,o.jsx)(a.M,{variant:"subtle",size:20,radius:"xl",color:n?"chatbox-secondary":"chatbox-tertiary",onClick:()=>{(0,g.v7)(t,s,"prev")},children:(0,o.jsx)(Q.A,{})}),(0,o.jsx)(E.A,{position:"bottom",items:[{text:d("expand"),icon:Y,onClick:()=>(0,g.VC)(t,s)},{divider:!0},{doubleCheck:!0,text:d("delete"),icon:T.A,onClick:()=>(0,g.ip)(t,s)}],children:(0,o.jsxs)(V.E,{c:n?"chatbox-secondary":"chatbox-tertiary",size:"xs",className:"cursor-pointer",children:[r.position+1," / ",r.lists.length]})}),(0,o.jsx)(a.M,{variant:"subtle",size:20,radius:"xl",color:n?"chatbox-secondary":"chatbox-tertiary",onClick:()=>(0,g.v7)(t,s,"next"),children:(0,o.jsx)(ee.A,{})})]})}const we=(0,p.memo)((({thread:e,sessionId:t})=>{const{t:s}=(0,m.Bd)(),r=(0,N.Xr)(R.Kq),i=(0,p.useCallback)((()=>{r(e.id||!0)}),[r,e.id]),a=(0,p.useCallback)((async()=>{e.id&&await n.Ay.show("thread-name-edit",{sessionId:t,threadId:e.id})}),[e.id]),l=(0,p.useCallback)((()=>{e.id&&(0,g.pi)(t,e.id)}),[t,e.id]),c=(0,p.useCallback)((()=>{e.id&&(0,g.bs)(t,e.id)}),[t,e.id]),d=(0,p.useCallback)((()=>{e.id&&(0,g.x_)(t,e.id)}),[t,e.id]);return(0,o.jsx)("div",{className:"text-center pb-4 pt-8",children:(0,o.jsx)(E.A,{position:"bottom",items:[{text:s("Edit Thread Name"),icon:u.A,onClick:a},{text:s("Show in Thread List"),icon:te,onClick:i},{text:s("Continue this thread"),icon:se,onClick:l},{text:s("Move to Conversations"),icon:oe,onClick:c},{divider:!0},{doubleCheck:!0,text:s("delete"),icon:T.A,onClick:d}],children:(0,o.jsxs)("span",{className:"cursor-pointer font-bold border-solid border rounded-xxl py-2 px-3 border-slate-400/25",onDoubleClick:i,children:[(0,o.jsx)("span",{className:"pr-1 opacity-60",children:"#"}),(0,o.jsx)("span",{className:"truncate inline-block align-bottom max-w-[calc(50%-4rem)] md:max-w-[calc(30%-4rem)]",children:e.name||s("New Thread")}),e.createdAtLabel&&(0,o.jsx)("span",{className:"pl-1 opacity-60 text-xs",children:e.createdAtLabel})]})})})}));var Me=s(93976),Ae=s(69637),Te=(0,w.A)("outline","switch","IconSwitch",[["path",{d:"M15 4l4 0l0 4",key:"svg-0"}],["path",{d:"M14.75 9.25l4.25 -5.25",key:"svg-1"}],["path",{d:"M5 19l4 -4",key:"svg-2"}],["path",{d:"M15 19l4 0l0 -4",key:"svg-3"}],["path",{d:"M5 5l14 14",key:"svg-4"}]]),Se=s(725),Ie=s(90397);function Ne({session:e}){const{t}=(0,m.Bd)(),s=(0,ae.ok)(),[r,n]=(0,N.fp)(R.Kq),i=(0,p.useMemo)((()=>(0,ie.f$)(e)),[e]),a=(0,p.useMemo)((()=>(0,ie.a4)(e)),[e]),l=(0,p.useMemo)((()=>a?Object.values(a):[]),[a]),c=(0,p.useCallback)((e=>{const t=l.find((t=>t.id===e));if(!t)return;const s=i.findIndex((e=>e.id===t.firstMessageId));s>=0&&(0,Se.x$)(s,"start","smooth"),n(!1)}),[l,n,i]),d=(0,p.useCallback)((t=>{(0,g.pi)(e.id,t),n(!1)}),[e.id,n]);return(0,o.jsx)(Ie._s,{opened:!!r,onClose:()=>n(!1),position:"ar"===s?"left":"right",size:280,title:t("Thread History"),classNames:{body:"flex flex-col p-0 gap-xs"},children:l.map(((e,t)=>(0,o.jsx)(Le,{thread:e,goto:c,showHistoryDrawer:r,switchThread:d,lastOne:t===l.length-1},e.id)))})}function Le(e){const{t}=(0,m.Bd)(),{thread:s,goto:r,switchThread:l,lastOne:c}=e,d=s.name||t("New Thread"),h=(0,N.md)(R.sw),u=(0,v.L0)(),[x,b]=(0,p.useState)(!1),k=(0,p.useCallback)((()=>{n.Ay.show("thread-name-edit",{sessionId:h,threadId:s.id})}),[h,s.id]),y=(0,p.useCallback)((()=>{l(s.id)}),[l,s.id]);return(0,o.jsxs)(i.s,{gap:"sm",align:"center",onClick:()=>{r(s.id)},className:"group/thread-item px-xs py-xxs cursor-pointer hover:bg-chatbox-background-gray-secondary",children:[(0,o.jsx)(Me.E,{color:"chatbox-tertiary",size:"xs",children:s.messageCount}),(0,o.jsxs)(V.E,{size:"xs",lineClamp:1,flex:1,children:[d," (",s.createdAtLabel,")"]}),(0,o.jsx)(E.A,{position:"bottom",items:[{text:t("Edit Thread Name"),icon:Ae.A,onClick:k},{text:t("Switch"),icon:Te,onClick:y},{divider:!0},{doubleCheck:!0,text:t("delete"),icon:T.A,onClick:()=>{h&&(c?(0,g.ix)(h):(0,g.x_)(h,s.id))}}],opened:x,onChange:e=>b(e),children:(0,o.jsx)(a.M,{variant:"transparent",color:"chatbox-primary",className:u||x?"":"group-hover/thread-item:visible invisible",onClick:e=>e.stopPropagation(),children:(0,o.jsx)(j.n,{icon:S.A})})})]})}var ze=s(53574),Be=s(52166),Re=s(71323),Ee=s(66983);const We=function(){const{t:e}=(0,m.Bd)(),{sessionId:t}=Ee.q.useParams(),s=(0,Be.Z)(),{session:i,isFetching:a}=(0,B.wV)(t),l=(0,Re.P)(ze.A,(e=>e.setChatModel)),c=(0,Re.P)(ze.A,(e=>e.setPictureModel)),d=(0,p.useMemo)((()=>i?(0,ie.f$)(i):[]),[i]),h=(0,p.useMemo)((()=>d.find((e=>e.generating))),[d]),u=(0,p.useRef)(null),x=(0,p.useCallback)((()=>{s({to:"/",replace:!0})}),[s]);(0,p.useEffect)((()=>{setTimeout((()=>{Se.cs("auto")}),200)}),[]),(0,p.useEffect)((()=>{if(i){if("chat"===i.type&&i.settings){const{provider:e,modelId:t}=i.settings;e&&t&&l(e,t)}if("picture"===i.type&&i.settings){const{provider:e,modelId:t}=i.settings;e&&t&&c(e,t)}}}),[i?.settings,i?.type,i,l,c]);const b=(0,p.useCallback)(((e,t)=>{i&&(0,B.qO)(i.id,{settings:{...i.settings||{},provider:e,modelId:t}})}),[i]),k=(0,p.useCallback)((()=>!!i&&((0,g.L8)(i.id),!0)),[i]),v=(0,p.useCallback)((()=>!!i&&((0,g.ix)(i.id),!0)),[i]),y=(0,p.useCallback)((async({constructedMessage:e,needGenerating:t=!0})=>{i&&(u.current?.scrollToBottom("instant"),await(0,g.rj)(i.id,{newUserMsg:e,needGenerating:t}))}),[i]),j=(0,p.useCallback)((()=>!!i&&(n.Ay.show("session-settings",{session:i}),!0)),[i]),f=(0,p.useCallback)((()=>!!i&&(h?.generating&&(h?.cancel?.(),(0,g.w0)(i.id,{...h,generating:!1},!0)),!0)),[i,h]),w=(0,p.useMemo)((()=>{if(i?.settings?.modelId&&i?.settings?.provider)return{provider:i.settings.provider,modelId:i.settings.modelId}}),[i?.settings?.provider,i?.settings?.modelId]);return i?(0,o.jsxs)("div",{className:"flex flex-col h-full",children:[(0,o.jsx)(q,{session:i}),(0,o.jsx)(Ce,{ref:u,currentSession:i},`message-list${t}`),(0,o.jsx)(r.t,{name:"session-inputbox",children:(0,o.jsx)(O.A,{sessionId:i.id,sessionType:i.type,model:w,onStartNewThread:k,onRollbackThread:v,onSelectModel:b,onClickSessionSettings:j,generating:!!h,onSubmit:y,onStopGenerating:f},`input-box${i.id}`)}),(0,o.jsx)(Ne,{session:i})]}):!a&&(0,o.jsxs)("div",{className:"flex flex-1 flex-col items-center justify-center min-h-[60vh]",children:[(0,o.jsx)("div",{className:"text-2xl font-semibold text-gray-700 mb-4",children:e("Conversation not found")}),(0,o.jsx)(C.$,{variant:"outline",onClick:x,children:e("Back to HomePage")})]})}}}]);
//# sourceMappingURL=8477.929008c2bfbb4bf0dfe3.js.map